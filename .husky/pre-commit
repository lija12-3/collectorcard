#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Change to backend directory and run checks
cd backend

# Detect platform and run appropriate script
if [ "$(uname)" = "Darwin" ] || [ "$(uname)" = "Linux" ]; then
    # Unix-like system (macOS, Linux)
    if [ -f "scripts/pre-commit.sh" ]; then
        bash scripts/pre-commit.sh
    else
        # Fallback to inline commands
        echo "ğŸ” Running pre-commit checks (matching GitHub Actions)..."
        echo "ğŸ“ Running ESLint..."
        npx lint-staged
        echo "ğŸ’… Running Prettier check..."
        npm run format:check
        echo "ğŸ”§ Running TypeScript type check..."
        npm run type-check
        echo "ğŸ—ï¸ Building API application..."
        npm run build:api
        echo "ğŸ”’ Running security audit..."
        npm audit --audit-level=moderate
        echo "âœ… All pre-commit checks passed!"
    fi
else
    # Windows or other system
    if [ -f "scripts/pre-commit.ps1" ]; then
        powershell -ExecutionPolicy Bypass -File scripts/pre-commit.ps1
    else
        # Fallback to inline commands
        echo "ğŸ” Running pre-commit checks (matching GitHub Actions)..."
        echo "ğŸ“ Running ESLint..."
        npx lint-staged
        echo "ğŸ’… Running Prettier check..."
        npm run format:check
        echo "ğŸ”§ Running TypeScript type check..."
        npm run type-check
        echo "ğŸ—ï¸ Building API application..."
        npm run build:api
        echo "ğŸ”’ Running security audit..."
        npm audit --audit-level=moderate
        echo "âœ… All pre-commit checks passed!"
    fi
fi
